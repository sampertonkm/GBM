function dJdt = EarthHistory1(~,EH)

% Step 1. Match global variables set by primary box model script:
    global lambda_Sm147 lambda_Rb087 lambda_Lu176 ...
           lambda_U238 lambda_U235 lambda_Th232 Prodc Prodo Delam Subd ...
           SilW Serp Sed Anatx CONDITIONS

    global e12Sm e12Nd e21Sm e21Nd e13Sm e13Nd e31Sm e31Nd e24Sm ...
           e24Nd e43Sm e43Nd e45Sm e45Nd e52Sm e52Nd ...
           e12Rb e12Sr e21Rb e21Sr e13Rb e13Sr e31Rb e31Sr e24Rb ...
           e24Sr e43Rb e43Sr e45Rb e45Sr e52Rb e52Sr ...
           e12Lu e12Hf e21Lu e21Hf e13Lu e13Hf e31Lu e31Hf e24Lu ...
           e24Hf e43Lu e43Hf e45Lu e45Hf e52Lu e52Hf ...
           e12U e12Th e12Pb e21U e21Th e21Pb e13U e13Th e13Pb ...
           e31U e31Th e31Pb e24U e24Th e24Pb e43U e43Th e43Pb ...
           e45U e45Th e45Pb e52U e52Th e52Pb
   
% STEP 2. Preallocate and solve the corresponding ODE:
dJdt = zeros(numel(CONDITIONS),1);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Solve for changes in reservoir masses:
dJdt(1) = -Prodc-Prodo+Delam+Subd; % change in mass of mantle
dJdt(2) = -Delam-SilW+Prodc+Anatx; % change in mass of continental crust
dJdt(3) = -Subd+Prodo+Serp;        % change in mass of oceanic crust
dJdt(4) = -Sed-Serp+SilW;          % change in mass of the ocean
dJdt(5) = -Anatx+Sed;              % change in mass of sediments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% #1: Solve for Sm147-Nd143:
dJdt(6)  = -lambda_Sm147*EH(6) -((Prodc/EH(1))*EH(6)*e12Sm)...
            -((Prodo/EH(1))*EH(6)*e13Sm) +((Delam/EH(2))*EH(8)*e21Sm)...
            +((Subd/EH(3))*EH(10)*e31Sm); 
            % change in Sm-147, mantle     
dJdt(7)  =  lambda_Sm147*EH(6) -((Prodc/EH(1))*EH(7)*e12Nd)...
            -((Prodo/EH(1))*EH(7)*e13Nd) +((Delam/EH(2))*EH(9)*e21Nd)...
            +((Subd/EH(3))*EH(11)*e31Nd);
            % change in Nd-143, mantle            
dJdt(8)  = -lambda_Sm147*EH(8) -((SilW/EH(2))*EH(8)*e24Sm)...
            -((Delam/EH(2))*EH(8)*e21Sm) +((Prodc/EH(1))*EH(6)*e12Sm)...
            +((Anatx/EH(5))*EH(14)*e52Sm); 
            % change in Sm-147, continental crust            
dJdt(9)  =  lambda_Sm147*EH(8) -((SilW/EH(2))*EH(9)*e24Nd)...
            -((Delam/EH(2))*EH(9)*e21Nd) +((Prodc/EH(1))*EH(7)*e12Nd)...
            +((Anatx/EH(5))*EH(15)*e52Nd);
            % change in Nd-143, continental crust            
dJdt(10) = -lambda_Sm147*EH(10) -((Subd/EH(3))*EH(10)*e31Sm)...
            +((Prodo/EH(1))*EH(6)*e13Sm) +((Serp/EH(4))*EH(12)*e43Sm); 
            % change in Sm-147, oceanic crust            
dJdt(11) =  lambda_Sm147*EH(10) -((Subd/EH(3))*EH(11)*e31Nd)...
            +((Prodo/EH(1))*EH(7)*e13Nd) +((Serp/EH(4))*EH(13)*e43Nd); 
            % change in Nd-143, oceanic crust            
dJdt(12) = -lambda_Sm147*EH(12) -((Serp/EH(4))*EH(12)*e43Sm)...
            -((Sed/EH(4))*EH(12)*e45Sm) +((SilW/EH(2))*EH(8)*e24Sm);
            % change in Sm-147, the ocean
dJdt(13) =  lambda_Sm147*EH(12) -((Serp/EH(4))*EH(13)*e43Nd)...
           -((Sed/EH(4))*EH(13)*e45Nd) +((SilW/EH(2))*EH(9)*e24Nd);
           % change in Nd-143, the ocean           
dJdt(14) = -lambda_Sm147*EH(14) -((Anatx/EH(5))*EH(14)*e52Sm)...
            +((Sed/EH(4))*EH(12)*e45Sm); 
            % change in Sm-147, sediments            
dJdt(15) =  lambda_Sm147*EH(14) -((Anatx/EH(5))*EH(15)*e52Nd)...
            +((Sed/EH(4))*EH(13)*e45Nd);
            % change in Nd-143, sediments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% #2: Solve for Rb087-Sr087:
dJdt(16)  = -lambda_Rb087*EH(16) -((Prodc/EH(1))*EH(16)*e12Rb)...
            -((Prodo/EH(1))*EH(16)*e13Rb) +((Delam/EH(2))*EH(18)*e21Rb)...
            +((Subd/EH(3))*EH(20)*e31Rb); 
            % change in Rb-87, mantle            
dJdt(17)  =  lambda_Rb087*EH(16) -((Prodc/EH(1))*EH(17)*e12Sr)...
            -((Prodo/EH(1))*EH(17)*e13Sr) +((Delam/EH(2))*EH(19)*e21Sr)...
            +((Subd/EH(3))*EH(21)*e31Sr);
            % change in Sr-87, mantle           
dJdt(18)  = -lambda_Rb087*EH(18) -((SilW/EH(2))*EH(18)*e24Rb)...
            -((Delam/EH(2))*EH(18)*e21Rb) +((Prodc/EH(1))*EH(16)*e12Rb)...
            +((Anatx/EH(5))*EH(24)*e52Rb); 
            % change in Rb-87, continental crust            
dJdt(19)  =  lambda_Rb087*EH(18) -((SilW/EH(2))*EH(19)*e24Sr)...
            -((Delam/EH(2))*EH(19)*e21Sr) +((Prodc/EH(1))*EH(17)*e12Sr)...
            +((Anatx/EH(5))*EH(25)*e52Sr);
            % change in Sr-87, continental crust            
dJdt(20) = -lambda_Rb087*EH(20) -((Subd/EH(3))*EH(20)*e31Rb)...
            +((Prodo/EH(1))*EH(16)*e13Rb) +((Serp/EH(4))*EH(22)*e43Rb); 
            % change in Rb-87, oceanic crust            
dJdt(21) =  lambda_Rb087*EH(20) -((Subd/EH(3))*EH(21)*e31Sr)...
            +((Prodo/EH(1))*EH(17)*e13Sr) +((Serp/EH(4))*EH(23)*e43Sr); 
            % change in Sr-87, oceanic crust            
dJdt(22) = -lambda_Rb087*EH(22) -((Serp/EH(4))*EH(22)*e43Rb)...
            -((Sed/EH(4))*EH(22)*e45Rb) +((SilW/EH(2))*EH(18)*e24Rb);
            % change in Rb-87, the ocean            
dJdt(23) =  lambda_Rb087*EH(22) -((Serp/EH(4))*EH(23)*e43Sr)...
           -((Sed/EH(4))*EH(23)*e45Sr) +((SilW/EH(2))*EH(19)*e24Sr);
           % change in Sr-87, the ocean           
dJdt(24) = -lambda_Rb087*EH(24) -((Anatx/EH(5))*EH(24)*e52Rb)...
            +((Sed/EH(4))*EH(22)*e45Rb); 
            % change in Rb-87, sediments            
dJdt(25) =  lambda_Rb087*EH(24) -((Anatx/EH(5))*EH(25)*e52Sr)...
            +((Sed/EH(4))*EH(23)*e45Sr);
            % change in Sr-87, sediments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% #3: Solve for Lu176-Hf176:
dJdt(26)  = -lambda_Lu176*EH(26) -((Prodc/EH(1))*EH(26)*e12Lu)...
            -((Prodo/EH(1))*EH(26)*e13Lu) +((Delam/EH(2))*EH(28)*e21Lu)...
            +((Subd/EH(3))*EH(30)*e31Lu); 
            % change in Lu-176, mantle
dJdt(27)  =  lambda_Lu176*EH(26) -((Prodc/EH(1))*EH(27)*e12Hf)...
            -((Prodo/EH(1))*EH(27)*e13Hf) +((Delam/EH(2))*EH(29)*e21Hf)...
            +((Subd/EH(3))*EH(31)*e31Hf);
            % change in Hf-176, mantle
dJdt(28)  = -lambda_Lu176*EH(28) -((SilW/EH(2))*EH(28)*e24Lu)...
            -((Delam/EH(2))*EH(28)*e21Lu) +((Prodc/EH(1))*EH(26)*e12Lu)...
            +((Anatx/EH(5))*EH(34)*e52Lu); 
            % change in Lu-176, continental crust
dJdt(29)  =  lambda_Lu176*EH(28) -((SilW/EH(2))*EH(29)*e24Hf)...
            -((Delam/EH(2))*EH(29)*e21Hf) +((Prodc/EH(1))*EH(27)*e12Hf)...
            +((Anatx/EH(5))*EH(35)*e52Hf);
            % change in Hf-176, continental crust
dJdt(30) = -lambda_Lu176*EH(30) -((Subd/EH(3))*EH(30)*e31Lu)...
            +((Prodo/EH(1))*EH(26)*e13Lu) +((Serp/EH(4))*EH(32)*e43Lu); 
            % change in Lu-176, oceanic crust
dJdt(31) =  lambda_Lu176*EH(30) -((Subd/EH(3))*EH(31)*e31Hf)...
            +((Prodo/EH(1))*EH(27)*e13Hf) +((Serp/EH(4))*EH(33)*e43Hf); 
            % change in Hf-176, oceanic crust
dJdt(32) = -lambda_Lu176*EH(32) -((Serp/EH(4))*EH(32)*e43Lu)...
            -((Sed/EH(4))*EH(32)*e45Lu) +((SilW/EH(2))*EH(28)*e24Lu);
            % change in Lu-176, the ocean
dJdt(33) =  lambda_Lu176*EH(32) -((Serp/EH(4))*EH(33)*e43Hf)...
           -((Sed/EH(4))*EH(33)*e45Hf) +((SilW/EH(2))*EH(29)*e24Hf);
           % change in Hf-176, the ocean
dJdt(34) = -lambda_Lu176*EH(34) -((Anatx/EH(5))*EH(34)*e52Lu)...
            +((Sed/EH(4))*EH(32)*e45Lu); 
            % change in Lu-176, sediments
dJdt(35) =  lambda_Lu176*EH(34) -((Anatx/EH(5))*EH(35)*e52Hf)...
            +((Sed/EH(4))*EH(33)*e45Hf);
            % change in Hf-176, sediments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% #4: Solve for U238-Pb206:
dJdt(36)  = -lambda_U238*EH(36) -((Prodc/EH(1))*EH(36)*e12U)...
            -((Prodo/EH(1))*EH(36)*e13U) +((Delam/EH(2))*EH(38)*e21U)...
            +((Subd/EH(3))*EH(40)*e31U); 
            % change in U-238, mantle
dJdt(37)  =  lambda_U238*EH(36) -((Prodc/EH(1))*EH(37)*e12Pb)...
            -((Prodo/EH(1))*EH(37)*e13Pb) +((Delam/EH(2))*EH(39)*e21Pb)...
            +((Subd/EH(3))*EH(41)*e31Pb);
            % change in Pb-206, mantle
dJdt(38)  = -lambda_U238*EH(38) -((SilW/EH(2))*EH(38)*e24U)...
            -((Delam/EH(2))*EH(38)*e21U) +((Prodc/EH(1))*EH(36)*e12U)...
            +((Anatx/EH(5))*EH(44)*e52U); 
            % change in U-238, continental crust
dJdt(39)  =  lambda_U238*EH(38) -((SilW/EH(2))*EH(39)*e24Pb)...
            -((Delam/EH(2))*EH(39)*e21Pb) +((Prodc/EH(1))*EH(37)*e12Pb)...
            +((Anatx/EH(5))*EH(45)*e52Pb);
            % change in Pb-206, continental crust
dJdt(40) = -lambda_U238*EH(40) -((Subd/EH(3))*EH(40)*e31U)...
            +((Prodo/EH(1))*EH(36)*e13U) +((Serp/EH(4))*EH(42)*e43U); 
            % change in U-238, oceanic crust
dJdt(41) =  lambda_U238*EH(40) -((Subd/EH(3))*EH(41)*e31Pb)...
            +((Prodo/EH(1))*EH(37)*e13Pb) +((Serp/EH(4))*EH(43)*e43Pb); 
            % change in Pb-206, oceanic crust
dJdt(42) = -lambda_U238*EH(42) -((Serp/EH(4))*EH(42)*e43U)...
            -((Sed/EH(4))*EH(42)*e45U) +((SilW/EH(2))*EH(38)*e24U);
            % change in U-238, the ocean
dJdt(43) =  lambda_U238*EH(42) -((Serp/EH(4))*EH(43)*e43Pb)...
           -((Sed/EH(4))*EH(43)*e45Pb) +((SilW/EH(2))*EH(39)*e24Pb);
           % change in Pb-206, the ocean
dJdt(44) = -lambda_U238*EH(44) -((Anatx/EH(5))*EH(44)*e52U)...
            +((Sed/EH(4))*EH(42)*e45U); 
            % change in U-238, sediments
dJdt(45) =  lambda_U238*EH(44) -((Anatx/EH(5))*EH(45)*e52Pb)...
            +((Sed/EH(4))*EH(43)*e45Pb);
            % change in Pb-206, sediments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% #5: Solve for U235-Pb207:
dJdt(46)  = -lambda_U235*EH(46) -((Prodc/EH(1))*EH(46)*e12U)...
            -((Prodo/EH(1))*EH(46)*e13U) +((Delam/EH(2))*EH(48)*e21U)...
            +((Subd/EH(3))*EH(50)*e31U); 
            % change in U-235, mantle
dJdt(47)  =  lambda_U235*EH(46) -((Prodc/EH(1))*EH(47)*e12Pb)...
            -((Prodo/EH(1))*EH(47)*e13Pb) +((Delam/EH(2))*EH(49)*e21Pb)...
            +((Subd/EH(3))*EH(51)*e31Pb);
            % change in Pb-207, mantle
dJdt(48)  = -lambda_U235*EH(48) -((SilW/EH(2))*EH(48)*e24U)...
            -((Delam/EH(2))*EH(48)*e21U) +((Prodc/EH(1))*EH(46)*e12U)...
            +((Anatx/EH(5))*EH(54)*e52U); 
            % change in U-235, continental crust
dJdt(49)  =  lambda_U235*EH(48) -((SilW/EH(2))*EH(49)*e24Pb)...
            -((Delam/EH(2))*EH(49)*e21Pb) +((Prodc/EH(1))*EH(47)*e12Pb)...
            +((Anatx/EH(5))*EH(55)*e52Pb);
            % change in Pb-207, continental crust
dJdt(50) = -lambda_U235*EH(50) -((Subd/EH(3))*EH(50)*e31U)...
            +((Prodo/EH(1))*EH(46)*e13U) +((Serp/EH(4))*EH(52)*e43U); 
            % change in U-235, oceanic crust
dJdt(51) =  lambda_U235*EH(50) -((Subd/EH(3))*EH(51)*e31Pb)...
            +((Prodo/EH(1))*EH(47)*e13Pb) +((Serp/EH(4))*EH(53)*e43Pb); 
            % change in Pb-207, oceanic crust
dJdt(52) = -lambda_U235*EH(52) -((Serp/EH(4))*EH(52)*e43U)...
            -((Sed/EH(4))*EH(52)*e45U) +((SilW/EH(2))*EH(48)*e24U);
            % change in U-235, the ocean
dJdt(53) =  lambda_U235*EH(52) -((Serp/EH(4))*EH(53)*e43Pb)...
           -((Sed/EH(4))*EH(53)*e45Pb) +((SilW/EH(2))*EH(49)*e24Pb);
           % change in Pb-207, the ocean
dJdt(54) = -lambda_U235*EH(54) -((Anatx/EH(5))*EH(54)*e52U)...
            +((Sed/EH(4))*EH(52)*e45U); 
            % change in U-235, sediments
dJdt(55) =  lambda_U235*EH(54) -((Anatx/EH(5))*EH(55)*e52Pb)...
            +((Sed/EH(4))*EH(53)*e45Pb);
            % change in Pb-207, sediments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% #6: Solve for Th232-Pb208:
dJdt(56)  = -lambda_Th232*EH(56) -((Prodc/EH(1))*EH(56)*e12Th)...
            -((Prodo/EH(1))*EH(56)*e13Th) +((Delam/EH(2))*EH(58)*e21Th)...
            +((Subd/EH(3))*EH(60)*e31Th); 
            % change in Th-232, mantle
dJdt(57)  =  lambda_Th232*EH(56) -((Prodc/EH(1))*EH(57)*e12Pb)...
            -((Prodo/EH(1))*EH(57)*e13Pb) +((Delam/EH(2))*EH(59)*e21Pb)...
            +((Subd/EH(3))*EH(61)*e31Pb);
            % change in Pb-208, mantle
dJdt(58)  = -lambda_Th232*EH(58) -((SilW/EH(2))*EH(58)*e24Th)...
            -((Delam/EH(2))*EH(58)*e21Th) +((Prodc/EH(1))*EH(56)*e12Th)...
            +((Anatx/EH(5))*EH(64)*e52Th); 
            % change in Th-232, continental crust
dJdt(59)  =  lambda_Th232*EH(58) -((SilW/EH(2))*EH(59)*e24Pb)...
            -((Delam/EH(2))*EH(59)*e21Pb) +((Prodc/EH(1))*EH(57)*e12Pb)...
            +((Anatx/EH(5))*EH(65)*e52Pb);
            % change in Pb-208, continental crust
dJdt(60) = -lambda_Th232*EH(60) -((Subd/EH(3))*EH(60)*e31Th)...
            +((Prodo/EH(1))*EH(56)*e13Th) +((Serp/EH(4))*EH(62)*e43Th); 
            % change in Th-232, oceanic crust
dJdt(61) =  lambda_Th232*EH(60) -((Subd/EH(3))*EH(61)*e31Pb)...
            +((Prodo/EH(1))*EH(57)*e13Pb) +((Serp/EH(4))*EH(63)*e43Pb); 
            % change in Pb-208, oceanic crust
dJdt(62) = -lambda_Th232*EH(62) -((Serp/EH(4))*EH(62)*e43Th)...
            -((Sed/EH(4))*EH(62)*e45Th) +((SilW/EH(2))*EH(58)*e24Th);
            % change in Th-232, the ocean
dJdt(63) =  lambda_Th232*EH(62) -((Serp/EH(4))*EH(63)*e43Pb)...
           -((Sed/EH(4))*EH(63)*e45Pb) +((SilW/EH(2))*EH(59)*e24Pb);
           % change in Pb-208, the ocean
dJdt(64) = -lambda_Th232*EH(64) -((Anatx/EH(5))*EH(64)*e52Th)...
            +((Sed/EH(4))*EH(62)*e45Th); 
            % change in Th-232, sediments
dJdt(65) =  lambda_Th232*EH(64) -((Anatx/EH(5))*EH(65)*e52Pb)...
            +((Sed/EH(4))*EH(63)*e45Pb);
            % change in Pb-208, sediments
end